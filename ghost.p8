pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()
	cls()
	px = 60
	py = 48
	
	moving = 1
	
	state = 1
	-- 1 happy 2 sad 3 hungry 4 angry 5 dead
	dialog = "initial"
	emotions = {}
	diff = 10
	speed = 10
	for i = 1, 3 do
		emotions[i] = 0
	end
	--1 anger 2 hunger 3 sadness
	
	counter = 0
	selection = 1
	press_duration = 10
	buttons = {}
	for i = 1,3 do
		buttons[i] = {}
		buttons[i].pressed=0
		buttons[i].selected=0
		buttons[i].lastpressed=press_duration
	end
	
	buttons[1].selected = 16
	
end

function _update()
	 counter += 1
	 if counter > speed then
	 	counter = 0
			local emo = flr(rnd(3))
			if emotions[1+emo] < 100 then
					emotions[1+emo] += diff
			end
		end
		if btnp(0) then
				selection -= 1
				if selection == 0 then selection = 3 end
		end
		if btnp(1) then 
				selection += 1
				if selection == 4 then selection = 1 end
		end
		if btnp(ðŸ…¾ï¸) then
			buttons[selection].pressed=1
			buttons[selection].lastpressed=0
			if state != 5 then
					if emotions[selection] > 0 then
							emotions[selection] -= diff
					end
			end 
		end
		if btnp(âŽ) and state == 5 then
			_init()
		end
		

	for i = 1, 3 do
			if selection == i then
				buttons[i].selected = 16
			else
				buttons[i].selected = 0
			end
			
			if buttons[i].lastpressed == press_duration then
					buttons[i].pressed=0
			else
					buttons[i].lastpressed += 1
			end
	end
	
		if py > 52 or py < 44 then
			moving = moving * (-1)
		end
		
		py += moving
		
		if emotions[1]>90 and
					emotions[2]>90 and
					emotions[3]>90 then

			state = 5
			moving = 0
			dialog = "oh oh! press x"
		end
		
		if state != 5 then
			if emotions[1]>30 then
				state = 2
				dialog = "estoy triste"
			elseif emotions[2]>30 then
				state = 3
				dialog = "tengo hambre"
			elseif emotions[3]>30 then
				state = 4
				dialog = "estoy enojado"
			else
				state = 1
				dialog = "soy feliz :)"
			end
		end
		
end

function _draw()
	cls()
	rectfill(0,0,128,128,6)
	rectfill(32,32,96,64,0)
	rect(32,32,96,64,5)
	
--	line(32,32,96,64,5)
--	line(32,64,96,32,5)
--	rectfill(48,41,80,56,0)
--	rect(48,41,80,56,5)
	
	spr(state,px,py-3)
	spr(8,28,12,4,2)
	spr(10,60,12,2,2)
	spr(10,76,12,2,2)
	spr(12,92,12,1,2)
	print(dialog,32,16)
	
	print ("stats",40,72)
	--"healthbars"
	line(72,76,92,76)
	line(72,80,92,80)
	line(72,72,92,72)
	
	--"healthbars" with colors
	line(72,72,92-flr(emotions[1]/100*20),72,11-flr((emotions[1]-1)/25))
	line(72,76,92-flr(emotions[2]/100*20),76,11-flr((emotions[2]-1)/25))
	line(72,80,92-flr(emotions[3]/100*20),80,11-flr((emotions[3]-1)/25))
	
	spr(17+buttons[1].pressed+buttons[1].selected,44,88)
	spr(17+buttons[2].pressed+buttons[2].selected,60,88)
	spr(17+buttons[3].pressed+buttons[3].selected,76,88)
	
end
__gfx__
00000000056666500566665005666650056666500066666000000000000000000005555555555555555555555555555500000000000000000000000000000000
00000000066666600666666006666660066666600666666600000000000000000057777777777777777777777777777750000000000000000000000000000000
00700700567070655670706556707065567070650655655600000000000000000577777777777777777777777777777775000000000000000000000000000000
00077000666666666666666666666666666666660600600600000000000000000577777777777777777777777777777775000000000000000000000000000000
00077000656666666655556666777766660000660666566600000000000000000577777777777777777777777777777775000000000000000000000000000000
00700700665555666566666666000066660000660566666500000000000000000577777777777777777777777777777775000000000000000000000000000000
00000000666666666666666666666666666666660065656000000000000000000577777777777777777777777777777775000000000000000000000000000000
00000000656565656565656565656565656565650050505000000000000000000577777777777777777777777777777775000000000000000000000000000000
00000000000555000000000000000000000000000000000000000000000000000577777777777777777777777777777775000000000000000000000000000000
00000000005666500055500000000000000000000000000000000000000000000577777777777777777777777777777775000000000000000000000000000000
00000000056666650566650000000000000000000000000000000000000000000577777777777777777777777777777775000000000000000000000000000000
00000000556666655666665000000000000000000000000000000000000000000057777777777777777777777777777750000000000000000000000000000000
00000000556666655666665000000000000000000000000000000000000000000005555777755555555555555555555500000000000000000000000000000000
00000000555666505666665000000000000000000000000000000000000000000000000577500000000000000000000000000000000000000000000000000000
00000000055555000566650000000000000000000000000000000000000000000000000057500000000000000000000000000000000000000000000000000000
00000000005550000055500000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000
00000000000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005777500055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000057777750577750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000557777755777775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000557777755777775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555777505777775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055555000577750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005550000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
