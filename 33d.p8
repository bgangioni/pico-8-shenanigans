pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()

  scene = 1

  texto = "lo tienes en tu adn"
  tx = 4
  ty = 4
  tspeed = 1
  txd = 1
  tyd = 1
  
  centerframe = 16
  debug_counter = 0
  angv = 0
  testpoint2d = {}
  testpoint2d.x = 0
  testpoint2d.y = 0

  testpoint3d = {}
  testpoint3d.x = 0
  testpoint3d.y = (-0.5)
  testpoint3d.z = 1

  initx1 = 0
  inity1 = 0
  initz1 = 0
  initx2 = 0
  inity2 = 0
  initz2 = 0
  
  pulse_repeat = 0
  pulse = -0.01
  adn_z = 2

  adn_nodes = 10
  adn ={}
  for i =1, adn_nodes do
    local a = (i*2)-1
    local b = i*2

    adn[a] ={}
    adn[a].x = -0.1
    adn[a].y = 0.2 - (i-1)*0.05
    adn[a].z = 0
	
    adn[b] = {}
    adn[b].x = 0.1
    adn[b].y = adn[a].y
    adn[b].z = 0

    adn[a] = rotate_xz(adn[a],0.05*(i-1))
    adn[b] = rotate_xz(adn[b],0.05*(i-1))

  end
  ambientbw ={7,6,13,5,1}
  ambientcolor ={8,9,10,11,12}
  ambient= ambientbw

  numstars = 100
  starfield ={}
  for i = 1 , numstars do
    starfield[i] = {}
    starfield[i].x = rnd(8)-4
    starfield[i].y = rnd(8)-4
    starfield[i].z = rnd(10)-4
  end

end

function copypoint2d(point2d)
  local newp = {}
  for k,v in pairs(point2d) do
    newp[k] = v
  end
  return newp
end

function translate_z(point3d, dz)
  local newpoint3d = copypoint2d(point3d)
  newpoint3d.z += dz
  return newpoint3d
end

function normalize(point2d)
  local newpoint2d = copypoint2d(point2d)

  newpoint2d.x = flr((point2d.x * 64) + 64)
  newpoint2d.y = flr((point2d.y * 64 * (-1)) + 64)
  return newpoint2d
end

function psetnorm(point2d)
  local normalp = normalize(point2d)
  pset(normalp.x,normalp.y,point2d.color)
end

function project3to2(point3d)
  local point2d = {}
  point2d.x = point3d.x / point3d.z
  point2d.y = point3d.y / point3d.z
  point2d.color = point3d.color
  return point2d

end

function pset3d(point3d)
  psetnorm(project3to2(point3d))
end

function rotate_xz(point3d,angle)
  local newpoint3d = copypoint2d(point3d)
  local s = sin(angle)
  local c = cos(angle)

  newpoint3d.x = point3d.x*c - point3d.z*s
  newpoint3d.z = point3d.x*s + point3d.z*c

  return newpoint3d
end

function closest(pointa, pointb)
	if pointa.z > pointb.z then return pointb else return pointa end
end
function furthest(pointa,pointb)
	if pointa.z < pointb.z then return pointb else return pointa end
end

function draw_adn(x,y,z,angle)
  for i = 1, adn_nodes do
    local a = (i*2)-1
    local b = (i*2)
    local newa = rotate_xz(copypoint2d(adn[a]),angle)
    local newb = rotate_xz(copypoint2d(adn[b]),angle)

    newa.x = newa.x + x
    newb.x = newb.x + x
	
    newa.y = newa.y + y
    newb.y = newb.y + y
	
	newa.z = newa.z + z
    newb.z = newb.z + z

    local cl = normalize(project3to2(closest(newa,newb)))
    local fr = normalize(project3to2(furthest(newa,newb)))
	
	circfill(fr.x,fr.y,1,5)
    line(fr.x,fr.y,cl.x, cl.y, 3)
	circfill(cl.x,cl.y,1,13)
  end
end

function _update()
 if scene == 1 then
 --  debug_counter += 1
  
  tx += (txd * tspeed)
  ty += (tyd * tspeed)
  if tx > 50 or tx < 2 then txd = txd * (-1) end
  if ty > 122 or ty < 2 then tyd = tyd * (-1) end 
  
  for i = 1, numstars  do
    if starfield[i].z > (-5.1) then
      starfield[i].z -= 0.1
      starfield[i].color = ambient[flr((starfield[i].z+4)/2.5)+1]
    else
      starfield[i].z = 5
      starfield[i].x = rnd(8)-4
      starfield[i].y = rnd(8)-4
      starfield[i].color = ambient[1]
    end
  end

  angv -= 0.01
  if angv < (-1) then angv += 1 end

  if adn_z == 0 then adn_z += pulse
  else adn_z = adn_z + (pulse * adn_z * adn_z) end
  
  pulse_repeat += 1
  if pulse_repeat > 100 then
	pulse = pulse * (-1)
	pulse_repeat = 0
  end
 end  
end

function _draw()
 if scene == 1 then
  cls()
--  psetnorm(testpoint2d)
  for i = 1 , numstars do
--    pset3d(translate_z(rotate_xz(starfield[i],angv),10))
    pset3d(translate_z(starfield[i],5))
  end

  print(texto,tx-1+rnd(2),ty-1+rnd(2),flr(11+adn_z*12))
  print(texto,tx+rnd(2),ty+rnd(2),flr(11+adn_z*12)+1)
  print(texto,tx,ty,7)
  
  rect(64-centerframe+1,64-centerframe+1,64+centerframe+1,64+centerframe+1,1)
  rect(64-centerframe,64-centerframe,64+centerframe,64+centerframe, 2)
  draw_adn(0,0,adn_z,angv)
  
 end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000aaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000aaaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000aaaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000aaa00aaa00aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000aaa00aaa00aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aa77aaaaa77aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aa777777777aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000a888888000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aaa88888aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000aaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000101010000010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000010100000101000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000001000001000000010101010100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000001000000010000000000000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000001000000000101010101010001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000010101000100000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000001000100010000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
